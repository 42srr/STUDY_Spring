
### 웹 서버(Web Server), 웹 애플리케이션 서버(WAS)


#### 웹서버란

웹서버는 정적인 파일을 제공하는 서버입니다. 예를 들어, HTML, CSS, JavaScript, 이미지 파일 등을 사용자가 요청할 때 서버가 제공해줍니다.

#### 웹 애플리케이션 서버란

웹 애플리케이션 서버는 웹 서버 기능에 더해, 애플리케이션 로직을 처리하는 서버입니다. 즉, 프로그램을 실행하고 동적인 컨텐츠를 사용자에게 전달합니다.

#### 웹 서버와 웹 애플리케이션 서버의 차이점


| 구분    | Web Server                  | WAS                         |
| ----- | --------------------------- | --------------------------- |
| 주요 기능 | 정적 리소스 제공(HTML, CSS, 이미지 등) | 정적 리소스 + 동적 컨텐츠 제공          |
| 처리 대상 | 변하지 않는 파일                   | 데이터베이스에서 가져온 정보, 동적인 HTML 등 |
| 예시    | NGINX, Apache               | Tomcat, Jetty               |
| 장점    | 빠르고 간단함                     | 복잡한 애플리케이션 로직 처리 가능         |

#### 웹 시스템 구성


##### WAS, DB

웹 시스템은 단순히 WAS, DB만으로도 구성할 수 있습니다. WAS는 정적 리소스 뿐만 아니라 애플리케이션 로직도 처리할 수 있는 서버입니다. 

##### 웹 서버, WAS, DB

웹 서버와 WAS를 분리하여 구성하는 방법도 있습니다. 이 방법은 효율적인 리소스 관리와 서버 과부하 방지에 유리합니다. 정적 리소스를 웹 서버가 처리하고, 동적인 애플리케이션 로직은 WAS가 처리하게 됩니다. 이렇게 되면, 정적 리소스만 제공하는 웹 서버는 서버 장애가 발생하면 오류 화면을 제공할 수 있게 됩니다. 

- 웹 서버 : 정적 리소스(HTML, 이미지 등)를 빠르게 제공
- WAS : 애플리케이션 로직을 처리함
		ex) 사용자가 로그인할 때 데이터베이스에서 정보를 가져오는 작업수행
- DB : 데이터를 저장하고, WAS가 이를 필요할 때마다 가져옴


### 서블릿

웹 애플리케이션 서버를 직접 구현할 때, 의미있는 비즈니스 로직을 제외한 모든 것을 해줍니다. 서블릿은 HTTP 요청을 처리하고, HTTP응답을 생성하는 JAVA클래스입니다.
HttpServerletRequest 객체로 요청 정보를 다루고, HttpServerletResponse 객체로 응답을 처리합니다.

##### 서블릿 생명 주기

서블릿은 서버에 의해 생성, 초기화, 호출, 종료되는 생명주기를 가집니다.

```Java
@WebServlet(name = "helloServlet", urlPatterns = "/hello")
public class HelloServlet extends HttpServlet {
  @Override
  protected void service(HttpServletRequest request, HttpServletResponse response) {
    // 애플리케이션 로직 처리
  }
}
```
1. 서버가 처음 요청을 받을 때 서블릿 객체를 생성합니다.
2. 서블릿이 시작될 될 때 초기화 됩니다. - init()
3. 클라이언트의 요청이 올 때마다 service() 메서드가 호출됩니다.
4. 서블이 종료됩니다 - destroy()

##### 서블릿의 동작

- 클라이언트가 /hello URL을 요청하면, 서블릿이 호출됩니다. 
- service()메서드에서 요청을 처리하고 응답을 생성합니다. 
- 생성된 응답은 HttpServerletResponse 객체를 통해 클라이언트로 반환됩니다.


##### 서블릿 컨테이너

서블릿을 실행하는 서버를 서블릿 컨테이너라고 합니다. 서블릿 컨테이너는 서블릿의 생명주기를 관리하고, 요청을 서블릿에 전달하여 응답을 생성합니다. 

서블릿 컨테이너는 서블릿 객체를 싱글톤으로 관리합니다. 첫 요청시 객체를 생성하고 이후 요청에 같은 객체를 재사용합니다. 그렇기에 공유 변수를 조심해서 사용해야합니다.

서블릿 컨테이너는 여러 요청을 동시에 처리할 수 있도록 멀티쓰레드를 지원합니다.

즉, 서블릿은 웹 애플리케이션에 요청을 처리하고 응답을 생성하는 핵심적인 역할을 합니다.

### 동시 요청 - 멀티 쓰레드

#### 쓰레드란

- 쓰레드는 하나의 프로그램 내에서 독립적으로 실행되는 흐름입니다.
- 자바에서 애플리케이션을 실행하면 main이라는 이름의 기본 쓰레드가 실행됩니다.
- 하나의 쓰레드는 한 번에 하나의 코드 라인만 실행할 수 있습니다. 동시 처리가 필요하면, 여러 개의 쓰레드를 생성해야 합니다.

##### 쓰레드의 단일 요청 처리

- 단일 요청이 들어오면 서버는 하나의 쓰레드를 사용하여 해당 요청을 처리합니다.
- 예: 클라이언트가 `/hello` URL을 요청하면, 서버는 `helloServlet`을 실행하기 위해 하나의 쓰레드를 할당하고, 요청을 처리한 후 응답을 반환합니다.
- 이 과정에서 요청이 하나일 때는 쓰레드가 요청을 처리하고, 처리가 끝나면 쓰레드는 휴식 상태로 돌아갑니다.

##### 쓰레드의 다중 요청 처리

- 다중 요청이 들어오면, 서버는 각 요청에 대해 별도의 쓰레드를 할당하여 동시에 처리합니다.
- 예를 들어, 클라이언트가 동시에 `/hello1`와 `/hello2` 요청을 보내면, 서버는 각각의 요청에 대해 쓰레드를 하나씩 할당하여 병렬로 처리합니다.

##### 다중 요청시 쓰레드 생성의 장단점

- 장점 : 동시 요청을 처리할 수 있으며, 리소스(CPU, 메모리)가 허용될 때 까지 처리가능하며, 하나의 쓰레드가 지연되어도 나머지 쓰레드는 정상 동작합니다.
- 단점 : 각 요청마다 새로운 쓰레드를 생성하면, 쓰레드 생성하는 데 비용이 들고, 많은 요청이 들어오면 서버 리소스를 과도하게 소모할 수 있습니다. 이로 인해 응답 속도가 느려지고, 서버가 과부하로 다운될 위험이 있습니다.

#### 쓰레드 풀

쓰레드 풀은 미리 일정 수의 쓰레드를 생성해두고, 요청이 오면 이미 생성된 쓰레드를 사용하는 방식입니다. 이를 통해 쓰레드 생성 비용을 줄이고, 서버의 리소스를 효율적으로 관리할 수 있습니다.

##### 쓰레드 풀의 특징
- 필요한 쓰레드를 미리 풀에 저장하고 관리합니다.
- 클라이언트 요청이 오면 쓰레드 풀에서 사용할 수 있는 쓰레드를 꺼내어 할당합니다.
- 요청 처리가 끝나면 해당 쓰레드는 다시 풀에 반환됩니다.

##### 쓰레드 풀의 장점
- 쓰레드 생성 비용(CPU)을 줄일 수 있습니다.
- 응답 시간을 줄일 수 있습니다.
- 쓰레드의 최대 수를 제한함으로 서버 과부하를 예방하고, 많은 요청이 들어와도 안전하게 처리할 수 있습니다.

##### 쓰레드 풀의 단점
- 쓰레드가 부족하면 요청은 대기하거나 거절될 수 있습니다.

##### Max 쓰레드 수 

1. 너무 낮은 쓰레드 수 설정
	- 장점 : 서버 리소스를 아낄 수 있습니다
	- 단점 : 요청이 많아져 쓰레드가 부족해지면 응답 지연이 발생하거나 요청이 거절될 수 있습니다.
2. 너무 높은 쓰레드 수 설정
	- 장점 : 요청이 많을 때 여러 요청을 처리할 수 있습니다.
	- 단점 : CPU와 메모리 리소스가 과다하게 소모되어 서버가 다운될 수 있습니다.


### HTML, HTTP API, CSR, SSR

#### 정적 리소스 

정적 리소스는 변경되지 않는 고정 파일들을 의미합니다. 예를 들어 HTML, CSS, JS, 이미지 등이 있습니다.

빠르고 간단하게 파일을 제공할 수 있으며 파일 자체가 변하지 않는 특징을 가집니다.
##### 정적 리소스 처리 과정 
1. 사용자가 요청을 보냄
2. 웹 서버가 파일을 찾아서 그대로 반환
3. 브라우저가 파일을 받아서 화면에 표시

#### 동적인 HTML 페이지

정적인 HTML은 이미 만들어진 파일을 그대로 제공하지만, 동적인 HTML은 요청할 때마다 새로운 HTML을 생성해서 반환하는 방식입니다.

사용자의 요청에 따라 HTML내용이 달라질 수 있으며, 동적 페이지를 만들 수 있지만 속도는 정적 리소스보다 느린 특징을 가집니다.
##### 동적 HTML 처리과정
1. 사용자가 요청을 보냄
2. WAS가 요청을 받아 DB에서 주문 정보 조회
3. JSP, *타임리프* 같은 템플릿 엔진을 사용해 HTML을 동적으로 생성
4. 생성된 HTML을 브라우저에 반환
5. 브라우저가 HTML을 해석해 화면에 표시

#### HTTP API

HTML을 직접 반환하는 것이 아니라, 데이터를 반환하는 방식입니다. 화면없이 데이터만 제공하며, 앱, 웹, 서버간 데이터 통신에 사용됩니다. 
##### HTTP API 처리 과정
1. 사용자가 API를 호출
2. WAS가 DB에 주문 정보 조회
3. JSON 형식으로 데이터를 변환해서 클라이언트에 전달
4. 클라이언트가 데이터를 받아 화면에 출력

##### HTTP API의 다양한 사용 방식

1. 웹 -> 서버 : 웹 브라우저에서 Js이용해 HTTP API 호출
2. 앱 client -> 서버 : 앱이 HTTP API 호출해 ui 구성
3. 서버 -> 서버 : 한 서버가 다른 서버의 API 호출해서 데이터 가져옴

#### 서버 사이드 렌더링(SSR) vs 클라이언트 사이드 렌더링(CSR)

##### SSR 
- 서버에서 HTML을 완성해서 보내는 방식
- 브라우저는 받는 HTML을 그대로 출력
- 정적인 페이지에서 유리
- 타임리프 요즘 주목 백

##### SSR 처리 과정
1. 사용자 요청
2. 서버가 주문 정보 조회하여 HTML 생성
3. 완성된 HTML을 브라우저에 반환
4. 브라우저가 HTML을 표시

##### CSR
- js가 실행되어 동적으로 화면을 그리는 방식
- 초기에 비어있는 HTML, Js파일을 내려옴
- 이후 js가 HTTP API 호출해서 데이터를 가져와 화면 구성
- 동적인 UI에 유리
- 리엑트 뷰

##### CSR 처리 과정
1. 사용자가 요청
2. 서버가 비어있는 HTML, JS파일 반환
3. 브라우저가 js를 실행하여 API 호출
4. 서버가 주문 정보를 JSON으로 응답
5. 브라우저가 JSON을 받아 화면 동적으로 구성
